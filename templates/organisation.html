{% extends "dlf-base.html" %}

{%- if organisation["boundary"] -%}
  {% import 'docs/'+ organisation['organisation']|organisation_url +'/map.njk' as boundaryMap %}
{%- endif -%}

{% block head %}
{%- if organisation["boundary"] -%}
  {%- if boundaryMap -%}
    {{ boundaryMap.styles() }}
  {%- else -%}
<!-- include css and js for LeafletJS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css"
  integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ=="
  crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js"
  integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw=="
  crossorigin=""></script>
  {%- endif -%}
{%- endif -%}
{{ super() }}

{% endblock  %}

{% block beforeContent %}
  {{ govukPhaseBanner({
    "classes": "govuk-width-container",
    "tag": {
      "text": "prototype"
    },
    "html": 'This is a prototype. Please provide feedback to the Digital Land team.'
  }) }}

  {{ govukBreadcrumbs({
    "items": [
      {
        "text": "Digital Land",
        "href": "https://digital-land.github.io/"
      },
      {
        "text": "Organisations",
        "href": "https://digital-land.github.io/organisation/"
      },
      {
        "text": organisation["name"]
      }
    ]
  }) }}

{% endblock %}

{% block pageTitle %}{{organisation["name"]}} | Organisations | Digital Land{% endblock %}

{% block content %}
<div class="govuk-grid-row">
	<div class="govuk-grid-column-full">
  <span class="govuk-caption-xl">Organisation</span>
  <h1 class="govuk-heading-xl">{{organisation["name"]}}</h1>

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-l" id="organisation">Organisation</h2>
    <p class="govuk-body-l">
{% if organisation["start-date"] or organisation["end-date"] %}
  This organisation was
  {% if organisation["start-date"] %} established on the <time datetime="{{ organisation["start-date"] }}">{{ organisation["start-date-text"] }}</time>{% endif -%}
  {% if organisation["start-date"] and organisation["end-date"] %}{% if organisation["end-date"] <= today %} and was {% else %} and will be {% endif %}{% endif -%}
  {% if organisation["end-date"] %} dissolved on the <time datetime="{{ organisation["end-date"] }}">{{ organisation["end-date-text"] }}</time>{% endif -%}
  .
{% endif %}
    </p>

<dl class="govuk-summary-list">
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Organisation
    </dt>
    <dd class="govuk-summary-list__value">
      <a href="https://{{organisation["prefix"]}}.register.gov.uk/record/{{organisation["id"]}}">{{organisation["organisation"]}}</a>
    </dd>
  </div>

{% if organisation["local-authority-type"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Local authority type
    </dt>
    <dd class="govuk-summary-list__value">
      <a href="https://local-authority-type.register.gov.uk/record/{{organisation['local-authority-type']}}">{{organisation["local-authority-type"]}}</a>
      ({{organisation['local-authority-type']|local_authority_type}})

      {%- if organisation["constituent-districts"] -%}
      <div class="dlf-inset-card dlf-inset-card--s govuk-!-margin-top-3 govuk-!-margin-bottom-3">
        <div class="dlf-inset-card__header">
          <div class="dlf-inset-card__title">Constituent local authorities</div>
        </div>
        <div class="dlf-inset-card__body">
          <ul class="govuk-list">
            {%- for org in organisation["constituent-districts"] -%}
              <li><a class="govuk-link govuk-link--no-underline" href="{{ org['organisation']|organisation_url }}">{{ org['name'] }}</a></li>
            {%- endfor -%}
          </ul>
        </div>
      </div>
      {%- endif -%}
      {%- if organisation['combined-authority'] -%}
      <div class="dlf-inset-card dlf-inset-card--s govuk-!-margin-top-3 govuk-!-margin-bottom-3">
        <div class="dlf-inset-card__header">
          <div class="dlf-inset-card__title">Member of combined authority</div>
        </div>
        <div class="dlf-inset-card__body">
          <a class="govuk-link govuk-link--no-underline" href="{{ organisation['combined-authority']['organisation']|organisation_url }}">{{ organisation['combined-authority']['name'] }}</a></li>
        </div>
      </div>
      {%- endif -%}
    </dd>
  </div>
{% endif %}


  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Website
    </dt>
    <dd class="govuk-summary-list__value">
      <a href="{{organisation["website"]}}">{{organisation["website"]}}</a>
    </dd>
  </div>

{% if organisation["twitter"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
    Twitter
    </dt>
    <dd class="govuk-summary-list__value">
    <p>@<a href="https://twitter.com/{{organisation["twitter"]}}">{{organisation["twitter"]}}</a></p>
    </dd>
  </div>
{% endif %}

{% if organisation["wikidata"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
     Wikidata
    </dt>
    <dd class="govuk-summary-list__value">
    <a href="https://wikidata.org/wiki/{{organisation["wikidata"]}}">{{organisation["wikidata"]}}</a>
    </dd>
  </div>
{% endif %}

{% if organisation["billing-authority"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
     Billing authority
    </dt>
    <dd class="govuk-summary-list__value">
    {{organisation["billing-authority"]}}
    </dd>
  </div>
{% endif %}

{% if organisation["esd-inventories"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
     ESD Inventories
    </dt>
    <dd class="govuk-summary-list__value">
    <a href="https://inventories.opendata.esd.org.uk/{{organisation["esd-inventories"]}}">{{organisation["esd-inventories"]}}</a>
    </dd>
  </div>
{% endif %}

{% if organisation["addressbase-custodian"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
    AddressBase Custodian
    </dt>
    <dd class="govuk-summary-list__value">
    {{organisation["addressbase-custodian"]}}
    </dd>
  </div>
{% endif %}

  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      data.gov.uk
    </dt>
    <dd class="govuk-summary-list__value">
        <a href="https://data.gov.uk/search?filters%5Bpublisher%5D={{organisation["name"]}}">datasets</a>
    </dd>
  </div>

{% if organisation["opendatacommunities"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
    Open Data Communities organisation
    </dt>
    <dd class="govuk-summary-list__value">
    <p><a href="{{organisation["opendatacommunities"]}}">{{organisation["opendatacommunities"]}}</a></p>
    <input class="govuk-input copy-and-paste" type="text" value="{{organisation["opendatacommunities"]}}" readonly data-module="input-copy">
    <!-- see huffduffer.com for how @adactio does this beautifully -->
    <p></p>
    </dd>
  </div>
{% endif %}

  </dl>
</div>



</div>

{% if organisation["statistical-geography"] or organisation["toid"] or organisation["census-area"] or organisation["opendatacommunities-area"] %}
<div class="govuk-grid-row govuk-main-wrapper--l">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-l" id="geographical-area">Geographical area</h2>

<dl class="govuk-summary-list">

{% if organisation["statistical-geography"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Statistical geography
    </dt>
    <dd class="govuk-summary-list__value">
      <a href="http://statistics.data.gov.uk/id/statistical-geography/{{organisation["statistical-geography"]}}">{{organisation["statistical-geography"]}}</a>
    </dd>
  </div>
{% endif %}

{% if organisation["toid"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
     TOID
    </dt>
    <dd class="govuk-summary-list__value">
    <a href="http://data.ordnancesurvey.co.uk/id/{{organisation["toid"]}}">{{organisation["toid"]}}</a>
    </dd>
  </div>
{% endif %}

{% if organisation["census-area"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
    Census area
    </dt>
    <dd class="govuk-summary-list__value">
    {{organisation["census-area"]}}
    </dd>
  </div>
{% endif %}

{% if organisation["opendatacommunities-area"] %}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
    Open Data Communities area
    </dt>
    <dd class="govuk-summary-list__value">
    <p><a href="{{organisation["opendatacommunities-area"]}}">{{organisation["opendatacommunities-area"]}}</a></p>
    </dd>
  </div>
{% endif %}

{%- if organisation["local-resilience-forum"] -%}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      <a href="https://www.gov.uk/guidance/local-resilience-forums-contact-details" class="govuk-link">Local resilience forum</a>
    </dt>
    <dd class="govuk-summary-list__value">
    {{organisation["local-resilience-forum-name"]}}
    </dd>
  </div>
{%- endif -%}

{%- if organisation["region"] -%}
  <div class="govuk-summary-list__row">
    <dt class="govuk-summary-list__key">
      Region
    </dt>
    <dd class="govuk-summary-list__value">
    {{organisation["region-name"]}}
    </dd>
  </div>
{%- endif -%}

</dl>

{%- if organisation["boundary"] -%}
<div class="map-wrapper govuk-!-padding-top-0" data-module="boundary-map">
  <h4 class="govuk-heading-s">Boundary</h4>
  {% if boundaryMap %}
    {{ boundaryMap.html() }}
  {% else %}
    <div id="map" style="height: 400px;"></div>
  {% endif %}
</div>
<p class="govuk-body">Download the <a href="{{organisation['boundary']}}">boundary GeoJSON</a>.</p>
{%- endif -%}


  </div>
</div>
{% endif %}

<div class="govuk-grid-row govuk-main-wrapper--l">
  <div class="govuk-grid-column-two-thirds">
    <h2 class="govuk-heading-l" id="download">Download the data</h2>
    <p class="govuk-body">You can download the data on this page as:</p>
    <ul class="govuk-list">
      <li><a href="https://raw.githubusercontent.com/digital-land/organisation-dataset/master/collection/organisation.csv">CSV</a></li>
    </ul>
  </div>
</div>


{% endblock %}
{% block bodyEnd %}
{{ super() }}
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-127566551-1', 'auto');
ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

{%- if organisation["boundary"] -%}
{% if boundaryMap %}
  {{ boundaryMap.scripts(true) }}
{% else %}
  <script>
    const $mapElement = document.querySelector('[data-module="boundary-map"]');
    const boundaryURL = '{{organisation["boundary"]}}';
    if ($mapElement) {
      // Tile layers
      var tiles = L.tileLayer("https://tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      });

      // govuk consistent colours
      var colours = {
        lightBlue: "#1d70b8",
        darkBlue: "#003078",
        brown: "#594d00",
        yellow_brown: "#a0964e"
      };

      var latLng = L.latLng(52.561928, -1.464854);
      var map = L.map("map", {
        center: latLng,
        zoom: 5,
        layers: [tiles]
      });

      var geoBoundaries;
      fetch(boundaryURL)
        .then((response) => {
          return response.json();
        })
        .then((data) => {
          geoBoundaries = L.geoJSON(data, {
            style: {
              fillOpacity: 0.2,
              weight: 2,
              color: colours.darkBlue,
              fillColor: colours.lightBlue
            }
          }).addTo(map);
          map.fitBounds(geoBoundaries.getBounds());
        });
    }
  </script>
{% endif %}
{%- endif -%}

<script>
  const $inputCopyElements = document.querySelectorAll('[data-module*="input-copy"]')
  $inputCopyElements.forEach(function(el) {
      new window.DLFrontend.InputCopy(el).init()
  })
</script>
{% endblock %}
